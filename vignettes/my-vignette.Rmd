---
title: "my-vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE
)
```

```{r setup}
library(bbrosterplots)
```

This needs to be part of the package, will not be part of the input data:

* adding the cost for each player and inducement
* a table with all the skill colors, 

```{r}
# #devtools::install_github("kcuilla/reactablefmtr") # DO NOT USE THE CRAN VERSION IT IS OUTDATED, HOWEVER THIS VERSION ALSO HAS A BUG WITH A PR FIX OPEN
```

## Read example data

```{r}
data(df_rosters) 
df_rosters <- df_rosters %>%
    dplyr::filter(is.na(banned_due_to_star_player) & is.na(banned_due_to_inducements) & is.na(banned_due_to_number_of_skills))

data(df_rosters1)


group_name <- "Super League S6"
tournament_ruleset <- "EB25"
races <- unique(df_rosters$roster.name)
races <- races[1:3]
empty_out <- FALSE
```

## Define data input format

```{r}
df_rosters <- df_rosters %>% dplyr::ungroup() %>%
  dplyr::select(number, position, roster.name, team_id, coach_name, group_name, skill_name, cnt)
```

```{r}
df_rosters %>% dplyr::filter(coach_name == "gsverhoeven")
```


# Add roster metadata

```{r}

df_rosters <- add_roster_metadata(df_rosters)
```


Optional step: Delete the folder then recreates it, to ensure old pictures are not confused with the latest data

```{r folder cleaning}
if (empty_out) {
  unlink(tournament_ruleset, recursive = TRUE)
  dir.create(tournament_ruleset)
}
```

## Create heatmap plots

```{r heatmap, warning = FALSE, message = FALSE}
for(i in 1:length(races)){
  race_name <- races[i]
  create_rosterplot(df_rosters, group_name, race_name)
  
}
```


```{r}
plot <- create_rosterplot(df_rosters, group_name, race_name)
# first empty image is because func leaves THIS chunk in weird state
plot
```


# Create skill tables

For this we need the dataset without stacked skills.

```{r}
for(i in 1:length(races)){
  race_name <- races[i]
  make_skill_table(race_name, df_rosters1, return_table = FALSE)
}
```

# Create rosterbook

```{r}
render_rosterbook()
```
```{r}
library(bbrosterplots)
# load data in proper format
data(df_rosters)
# add skill color, cost and cluster sort order
df_rosters <- add_roster_metadata(df_rosters)
# create rosterplots
create_rosterplot(df_rosters, group_name, race_name)
# create skill tables
make_skill_table(race_name, df_rosters1, return_table = FALSE)
# render PDF
render_rosterbook()
```

