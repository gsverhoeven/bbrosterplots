---
title: 'Create Blood Bowl roster plots'
author: "Gertjan Verhoeven & Hiliadan"
date: '2025-08-19'
params:
  group_name: "Super League S6"
  tournament_ruleset: "EB25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Creating the plots

I switched to R For further processing of the data (including clustering) and creating the final roster visualizations. Full code is available in `create_plots.Rmd`. Processing of the data involved:

* adding the cost for each player and inducement (yes, I typed together a file with the cost of all the BB2020 rosters!), 
* creating a table with all the skill colors, 
* removing the bribes from the inducements that originated from the "Get the ref" kickoff event (but keeping those that are part of the roster)
* applying a hierarchical clustering algorithm (`hclust_order()` from my own wrapper package `ggoheatmap`) to create a sort order for the rosters.

I used `ggplot` create the final plots. For ease of sharing, I created `roster_book.Rmd` that generates a PDF that contains all 29 plots.

# I. Loading package and data
## Load packages

```{r}
# Load packages
library(tidyverse)
library(gridExtra)
library(janitor)
library(reactable)
library(htmltools) # for tagList()
#devtools::install_github("kcuilla/reactablefmtr") # DO NOT USE THE CRAN VERSION IT IS OUTDATED, HOWEVER THIS VERSION ALSO HAS A BUG WITH A PR FIX OPEN
library(reactablefmtr) 
#devtools::install_github("gsverhoeven/ggoheatmap")
library(ggoheatmap)
source("R/helper_functions.R")
source("R/cluster_input_data.R")
source("R/create_main_plot.R")
source("R/create_legend_plot.R")
source("R/write_rosterplot.R")
source("R/create_rosterplot.R")
```

## Read prepped data

```{r}
df_rosters <- readRDS("work/df_rosters_prepped_data.rds")
df_rosters1 <- readRDS("work/df_rosters1_raw_data.rds")
group_name <- params$group_name
tournament_ruleset <- params$tournament_ruleset
races <- unique(df_rosters$roster.name)
races <- races[1:3]
empty_out <- FALSE
```

Optional step: Delete the folder then recreates it, to ensure old pictures are not confused with the latest data

```{r folder cleaning}
if (empty_out) {
  unlink(tournament_ruleset, recursive = TRUE)
  dir.create(tournament_ruleset)
}
```

## Create heatmap plots

```{r heatmap, warning = FALSE, message = FALSE}
for(i in 1:length(races)){
  race_name <- races[i]
  grid.arrange(create_rosterplot(df_rosters, group_name, race_name))
  
}
```

# Create skill usage tables

For this we need the dataset without stacked skills.

```{r}
# Initialize a list to store the skill tables
skill_table_list <- list()

for(i in 1:length(races)){
  race_name <- races[i]
  # Store skill tables for the race in a list (so they can be displayed outside the loop all at once)
  skill_table_list[[i]] <- make_skill_table(race_name, df_rosters1)
}
```

